-- Toggle to enable/disable instant zombie attack and simulated input (using a and b functions)

local ZombiesSection = Tabs.Trick:AddSection("Zombies")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Knit = require(ReplicatedStorage.Packages.Knit)
local GraveMonsterController = Knit.GetController("GraveMonsterController")
local GraveMonsterService = Knit.GetService("GraveMonsterService")
local TweenService = game:GetService("TweenService")

-- Save the original AttackMonster function
local originalAttackMonster = GraveMonsterController.AttackMonster

local autoAttackThread = nil

local AutoBeatZombiesToggle = ZombiesSection:AddToggle("AutoBeatZombies", {
    Title = "Auto Beat Zombies",
    Description = "Automatically attack zombies - Works while fighting bosses!",
    Default = false
})

AutoBeatZombiesToggle:OnChanged(function()
    if AutoBeatZombiesToggle.Value then
        -- a(): Override AttackMonster to remove distance check
        GraveMonsterController.AttackMonster = function(p44, p45)
            local v_u_10 = require(ReplicatedStorage.Data.Halloween.GraveMonsters)
            local v_u_17 = GraveMonsterController
            local v_u_13 = game:GetService("Players").LocalPlayer.Character or game:GetService("Players").LocalPlayer.CharacterAdded:Wait()
            local v46 = v_u_13.PrimaryPart
            if v46 then
                local v47 = v_u_17.GetGraveModelById(p44)
                if v47 then
                    local v48 = p45.PrimaryPart
                    if v48 then
                        local v49 = v47:GetAttribute("Zone")
                        local v50 = v_u_10.Monsters[v49][p45.Name]
                        if v50 then
                            local _, v52 = GraveMonsterService:AttackMonster(p44):await()
                            if v52 then
                                local v53 = v52.NewHealth
                                local v54 = p45:GetAttribute("StartHealth")
                                local v55 = v53 / v54
                                local v56 = UDim2.fromScale(v55, 1)
                                local v57 = p45:WaitForChild("Head"):WaitForChild("Health")
                                v57.Health.Text = v53 .. "/" .. v54 .. " HP"
                                TweenService:Create(v57.Bar.Progress, TweenInfo.new(0.15, Enum.EasingStyle.Sine), {
                                    ["Size"] = v56
                                }):Play()
                                if v52.Defeated then
                                    GraveMonsterController.DefeatMonster(p44, p45)
                                end
                            end
                        end
                    end
                end
            end
        end

        -- b(): Simulate attack input (game thinks you are clicking)
        local fakeInput = {
            UserInputType = Enum.UserInputType.MouseButton1,
            KeyCode = Enum.KeyCode.Unknown
        }

        autoAttackThread = task.spawn(function()
            while AutoBeatZombiesToggle.Value do
                GraveMonsterController.InputBegan(fakeInput, false)
                task.wait()
            end
        end)
    else
        -- Restore the original AttackMonster function
        GraveMonsterController.AttackMonster = originalAttackMonster

        -- Stop simulated input thread
        if autoAttackThread then
            task.cancel(autoAttackThread)
            autoAttackThread = nil
        end
    end
end)
